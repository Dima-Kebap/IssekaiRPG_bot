import types
import random

from Enemys import *
from constants import *
from telebot import *


def bot_fight(user_id, user, enemys, bot, menu, newlvl):
    if user_id not in enemys.keys():  # —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–±–∞, –µ—Å–ª–∏ –±–æ—Ç –∫—Ä–∞—à–Ω—É–ª—Å—è –ø–æ—Å—Ä–µ–¥–∏ –±–æ—è
        enemy_create(user_id, enemys)
    enemy = enemys[user_id]
    dmg_to_enemy = enemy.take_damage(user.to_damage()) # –ø–æ–ª—É—á–µ–Ω–∏–µ –º–æ–±–æ–º —É—Ä–æ–Ω–∞ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if enemy.hp > 0:  # –µ—Å–ª–∏ –≤—Ä–∞–≥ –∂–∏–≤
        dmg_to_user = user.take_damage(enemy.to_damage())
        if user.hp > 0:  # –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–∏–≤
            bot.send_message(user_id, "–¢—ã –Ω–∞–Ω–µ—Å: " + str(dmg_to_enemy) +
                             " üí•\n–£ –≤—Ä–∞–≥–∞ –æ—Å—Ç–∞–ª–æ—Å—å:" + str(enemy.hp) +
                             " ‚ù§\n\n–í—Ä–∞–≥ —É–¥–∞—Ä–∏–ª: " + str(dmg_to_user) +
                             " üí•\n–£ —Ç–µ–±—è –æ—Å—Ç–∞–ª–æ—Å—å:" + str(user.hp) + " ‚ù§")
        else:  # –ï—Å–ª–∏ —É–º—Ä–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
            markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
            restart = types.KeyboardButton('/start') # –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫—É –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É –∑–∞–Ω–æ–≤–æ
            markup.add(restart)
            bot.send_message(user_id, user.death_msg(), reply_markup=markup)
            bot.send_sticker(user_id, DEATH_STICKER)
            user.menu = DEATH 
    else:  # –µ—Å–ª–∏ —É–º—Ä–µ—Ç –≤—Ä–∞–≥
        user.money += enemy.money # –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–µ–Ω–µ–≥ —Å –º–æ–±–∞
        bot.send_message(user_id, enemy.death + "\n\n" +
                         "–ó–∞ –ø–æ–±–µ–¥—É –Ω–∞–¥ –≤—Ä–∞–≥–æ–º —Ç—ã –ø–æ–ª—É—á–∏–ª {0}‚≠ê –∏ {1}üíµ".format(enemy.xp, enemy.money))
        user.enemy_count += 1 # —Å—á–µ—Ç—á–∏–∫ –º–æ–±–æ–≤
        user.xp += enemy.xp # –ø–æ–ª—É—á–µ–Ω–∏–µ —Ö—Ä –æ—Ç –º–æ–±–∞
        enemys.pop(user_id)
        if user.next_lvl(): # –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∏–≥ –ª–∏ –∏–≥—Ä–æ–∫ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
            newlvl(user_id, NEW_LVL) # –≤—ã–¥–∞—á–∞ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
        else:
            menu(user_id, GAME_MENU)  # –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∏–≥—Ä–æ–≤–æ–µ –º–µ–Ω—é


def enemy_create(user_id, enemys):  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–±–æ–≤
    if user_id not in enemys.keys(): # –µ—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –¥–µ—Ä–µ—Ç—Å—è —Å –º–æ–±–æ–º
        enm = random.randint(1, 4) # –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –º–æ–±–∞ –Ω–∞ —É—Å–ª–æ–≤–∏–∏ —Ç–æ–≥–æ –∫–∞–∫–æ–µ —á–∏—Å–ª–æ –≤—ã–ø–∞–¥–µ—Ç
        if enm == 1:
            enemys[user_id] = GiantCockroach.GiantCockroach()
        elif enm == 2:
            enemys[user_id] = Rat.Rat()
        elif enm == 3:
            enemys[user_id] = Slime.Slime()
        elif enm == 4:
            enemys[user_id] = Goblin.Goblin()
    # –û–ø–∏—Å–∞–Ω–∏–µ –º–æ–±–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –≤—Å—Ç–µ—Ä–µ—á–µ
    return enemys[user_id].description + "\n\n–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤—Ä–∞–≥–∞:\n" + repr(enemys[user_id])

